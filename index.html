<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ระบบขายสินค้า - ปรับปรุงหน้าแรก</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <!-- Styles -->
<link rel="stylesheet" href="./assets/css/Global-login.css">
<link rel="stylesheet" href="./assets/css/Sales.css">
<link rel="stylesheet" href="./assets/css/Summary.css">
<link rel="stylesheet" href="./assets/css/Compare.css">

  <!-- Firebase SDK (compat to match original) -->
  <script src="assets/js/firebase-init.js"></script>
  <script src="assets/js/fetch-shim.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <!-- Auth -->
  <div id="auth-container" class="auth-container">
    <div class="auth-card">
      <h2>เข้าสู่ระบบ</h2>
      <form id="login-form" class="auth-form">
        <input type="email" id="email" placeholder="อีเมล" required>
        <input type="password" id="password" placeholder="รหัสผ่าน" required>
        <button type="submit">เข้าสู่ระบบ</button>
      </form>
      <div id="auth-error-message" class="auth-error"></div>
    </div>
  </div>

  <!-- App -->
  <div id="app-container" style="display:none;">
    <button id="logout-btn" class="logout-btn">ออกจากระบบ</button>

    <!-- Dashboard -->
    <div class="dashboard">
      <p>ระบบขายสินค้า</p>
      <h1 id="current-time">00:00:00</h1>
      <p id="current-date"></p>
    </div>

    <!-- Navigation Bar -->
    <div class="main-nav">
      <div class="nav-btn active" data-page="sale">
        <i class="fas fa-shopping-cart"></i>
        <span>หน้าขาย</span>
      </div>
      <div class="nav-btn" data-page="summary">
        <i class="fas fa-chart-bar"></i>
        <span>สรุปยอด</span>
      </div>
      <div class="nav-btn" data-page="compare">
        <i class="fas fa-chart-line"></i>
        <span>เปรียบเทียบ</span>
      </div>
    </div>

    <!-- Sale Page -->
    <div id="sale-page" class="page container">
      <!-- Category Selector -->
      <div class="category-selector">
        <div class="category-card active" data-category="water">
          <i class="fas fa-cocktail"></i>
          <span>หมวดน้ำ</span>
        </div>
        <div class="category-card" data-category="med">
          <i class="fas fa-pills"></i>
          <span>หมวดยา</span>
        </div>
        <!-- Removed mix and free categories per user request. Only show water, med and other. -->
        <div class="category-card" data-category="other">
          <i class="fas fa-apple-alt"></i>
          <span>อื่น ๆ</span>
        </div>
      </div>

      <!-- Product Lists for each category -->
      <div class="product-lists">
        <div class="product-list active" id="product-list-water"></div>
        <div class="product-list" id="product-list-med"></div>
        <!-- Removed product lists for mix and free categories -->
        <div class="product-list" id="product-list-other"></div>
      </div>

      <!-- Floating Cart Icon -->
      <div class="cart-icon" id="cart-icon">
        <i class="fas fa-shopping-basket"></i>
        <span class="cart-count" id="cart-count">0</span>
      </div>

      <!-- Admin Controls -->
      <div class="admin-controls">
        <button id="add-product-btn" class="admin-btn"><i class="fas fa-plus"></i></button>
        <button id="remove-product-btn" class="admin-btn"><i class="fas fa-minus"></i></button>
        <button id="edit-product-btn" class="admin-btn"><i class="fas fa-edit"></i></button>
      </div>
    </div>

    <!-- Cart Modal -->
    <div id="cart-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-shopping-basket"></i> สรุปรายการสั่งซื้อ</h3>
        </div>
        <!-- Items will be injected here -->
        <div id="modal-items"></div>
        <div class="modal-total">รวมทั้งหมด: <span id="modal-cart-total">0</span> บาท</div>
        <!-- Buyer name and transfer checkbox -->
        <div class="buyer-info">
          <input type="text" id="buyer-name-input" class="buyer-name-input" placeholder="ชื่อลูกค้า (ไม่บังคับ)">
          <label class="transfer-global-option">
            <input type="checkbox" id="global-transfer-checkbox">
            <span>ชำระโดยการโอน (บันทึกเป็นยอดโอน)</span>
          </label>
        </div>
        <div class="modal-actions">
          <button class="confirm-btn" id="confirm-sale-btn"><i class="fas fa-check"></i> ยืนยันการขาย</button>
          <button class="cancel-btn" id="clear-cart-btn"><i class="fas fa-times"></i> ล้างตะกร้า</button>
        </div>
      </div>
    </div>

    <!-- Summary Page -->
    <div id="summary-page" class="page container summary-page">
      <h1>สรุปยอดขาย</h1>
      <!--
        Customer search bar
        This section provides an input for entering a customer's name and a
        button to trigger the search. When a name is entered and the
        search button is clicked, the system will fetch the customer's
        cumulative purchase history and display it in place of the daily
        report. Leaving the input empty and pressing search will reset
        the view back to the default daily report.
      -->
      <div class="customer-search">
        <input type="text" id="customerNameInput" name="customerNameInput" placeholder="กรอกชื่อลูกค้า" />
        <button id="searchButton">ค้นหา</button>
      </div>
      <div class="date-filter">
        <label for="report-date">วันที่:</label>
        <input type="date" id="report-date">
        <button id="load-report-btn">ดูรายงาน</button>
      </div>
      <div class="summary-box-container">
        <div class="summary-box">
          <h3>ยอดรวมเงินทั้งหมด</h3>
          <span id="total-revenue" class="value money">0</span>
          <span>บาท</span>
        </div>
        <div class="summary-box">
          <h3>ยอดรวมสินค้าที่ขายได้</h3>
          <!--
            Display the total quantity of items sold split by unit. The first
            number represents the number of bottles sold and is followed by
            the unit label (ขวด). The second number after the slash
            represents the total of all items sold that are not measured
            in bottles. It is styled via the .other-unit-value class to
            appear red.
          -->
          <span id="total-quantity-left" class="value">0</span>
          <span id="quantity-unit">ขวด</span>
          /
          <span id="total-quantity-right" class="value other-unit-value">0</span>
        </div>
        <div class="summary-box">
          <h3>รายการสินค้าที่ขายได้ (สรุป)</h3>
          <ul id="product-summary-list"></ul>
        </div>
      </div>
      <table class="summary-table">
        <thead>
          <tr>
            <th>วันที่และเวลา</th>
            <th>ชื่อ / สินค้า</th>
            <th>จำนวน</th>
            <th>ยอดรวม</th>
            <th>จัดการ</th>
          </tr>
        </thead>
        <tbody id="report-body"></tbody>
      </table>
      <div id="no-data" class="no-data" style="display:none;">ไม่พบข้อมูลการขายในวันที่เลือก</div>
    </div>

    <!-- Compare Page -->
    <div id="compare-page" class="page container summary-page">
      <h1>เปรียบเทียบยอดขาย</h1>
      <div class="compare-mode-selection">
        <label for="compare-mode-select">เลือกโหมดเปรียบเทียบ:</label>
        <select id="compare-mode-select">
          <option value="day-to-day">วันต่อวัน</option>
          <option value="date-range">ช่วงวัน</option>
        </select>
        <button id="clear-compare-btn">ล้างข้อมูล</button>
      </div>
      <div class="comparison-input-group">
        <!-- Day to Day -->
        <div id="day-to-day-mode" class="compare-mode-form active">
          <div class="comparison-date-group">
            <label for="compare-date-1">วันที่ 1:</label>
            <input type="date" id="compare-date-1">
          </div>
          <div class="comparison-date-group">
            <label for="compare-date-2">วันที่ 2:</label>
            <input type="date" id="compare-date-2">
          </div>
        </div>
        <!-- Date Range -->
        <div id="date-range-mode" class="compare-mode-form">
          <div class="comparison-date-group">
            <label for="start-date-1">ช่วงที่ 1 เริ่ม:</label>
            <input type="date" id="start-date-1">
            <label for="end-date-1">ถึง:</label>
            <input type="date" id="end-date-1">
          </div>
          <div class="comparison-date-group">
            <label for="start-date-2">ช่วงที่ 2 เริ่ม:</label>
            <input type="date" id="start-date-2">
            <label for="end-date-2">ถึง:</label>
            <input type="date" id="end-date-2">
          </div>
        </div>
        <!-- Product Selection -->
        <div class="date-filter compare-style">
          <label for="product-select">เลือกสินค้า:</label>
          <select id="product-select"></select>
          <button id="compare-btn">เปรียบเทียบ</button>
        </div>
      </div>
      <div id="detailed-comparison-result" style="margin-top: 20px;"></div>
      <div id="no-comparison-data" class="no-data" style="display:none;">ไม่พบข้อมูลสำหรับเปรียบเทียบ</div>
      <div class="chart-container">
        <canvas id="comparisonChart"></canvas>
      </div>
    </div>
  </div>

  <!-- App Scripts (modules) -->
  <script type="module" src="./assets/js/config.js"></script>
  <script type="module" src="./assets/js/firebase.js"></script>
  <script type="module" src="./assets/js/auth.js"></script>
  <script type="module" src="./assets/js/ui.js"></script>
  <script type="module" src="./assets/js/cart.js"></script>
  <script type="module" src="./assets/js/sales.js"></script>
  <script type="module" src="./assets/js/report.js"></script>
  <script type="module" src="./assets/js/compare.js"></script>
  <script type="module" src="./assets/js/main.js"></script>
  <!-- Customer search module: handles searching for customer profiles
       without refreshing the page and integrates with the existing
       report system. Placed after other scripts to ensure all
       dependencies are loaded. -->
  <script type="module" src="./assets/js/customerSearch.js"></script>
</body>

</html>
